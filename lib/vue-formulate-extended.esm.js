import e from"@braid/vue-formulate";import{shallowEqualObjects as t}from"@braid/vue-formulate/src/libs/utils.js";import o from"imask";import r from"@braid/vue-formulate/src/Formulate";var n=function(e){return void 0===e&&(e=[]),this.defaultHook=function(e){return e},this.setHooks(e)};n.prototype.parse=function(e){void 0===e&&(e=[]);var t=Array.isArray(e)?e:[];for(var o of t)this.isProperHook(o)&&this.hooks.push(o);return this},n.prototype.addHook=function(e){return this.isProperHook(e)&&this.isNewHook(e)&&this.hooks.push(e),this},n.prototype.setHooks=function(e){return void 0===e&&(e=[]),this.hooks=e.filter(this.isProperHook),this},n.prototype.setDefault=function(e){return this.defaultHook=e,this},n.prototype.isProperHook=function(e){return e&&"object"==typeof e&&"function"==typeof e.handler},n.prototype.isNewHook=function(e){return this.hooks.findIndex((function(t){return t===e}))<0},n.prototype.getHooks=function(){return this.hooks},n.prototype.empty=function(){return 0===this.hooks.length},n.prototype.apply=function(e,t){return this.empty()?this.defaultHook(e,t):this.hooks.reduce((function(e,o){return o.handler(e,t)}),e)},n.prototype.asSingleHook=function(){var e=this;return{handler:function(t,o){return e.apply(t,o)}}};var s={type:Object,default:function(){return{model:[],schema:[],schemaOptions:[],schemaNode:[],schemaComponent:[]}}};function i(e,t,o,r,n,s,i,a,u,c){"boolean"!=typeof i&&(u=a,a=i,i=!1);var f,d="function"==typeof o?o.options:o;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,n&&(d.functional=!0)),r&&(d._scopeId=r),s?(f=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,u(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)},d._ssrRegister=f):t&&(f=i?function(e){t.call(this,c(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,a(e))}),f)if(d.functional){var m=d.render;d.render=function(e,t){return f.call(t),m(e,t)}}else{var p=d.beforeCreate;d.beforeCreate=p?[].concat(p,f):[f]}return o}var a=i({},void 0,{extends:e.defaults.components.FormulateInput,props:{modelHook:{type:[Function,Object,Array],default:null}},watch:{"context.model":{handler:function(e,t){var o=new n;Array.isArray(this.modelHook)?this.modelHook.map((function(e){return o.addHook(e)})):"function"==typeof this.modelHook?o.addHook({handler:this.modelHook}):o.addHook(this.modelHook),(this.$formulate.options.hooks&&this.$formulate.options.hooks.model?this.$formulate.options.hooks.model:[]).map((function(e){return o.addHook(e)})),e!==t&&(this.context.model=o.apply(e,{oldModel:t,context:this.context}))}}}},void 0,void 0,void 0,!1,void 0,void 0,void 0);function u(e,t,o){void 0===o&&(o={});var r=o.hooks,s=o.h,i=o.state;if(e&&"object"==typeof e&&!Array.isArray(e)){var u=e.children;void 0===u&&(u=null);var f=e.component;void 0===f&&(f=a);var d=e.depth;void 0===d&&(d=1);var m=e.modelHook,p=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===t.indexOf(r)&&(o[r]=e[r]);return o}(e,["children","component","depth","modelHook"]),h=f===a?p.type||"text":"",l=p.name||h||"el",v=p.id||l+"-"+d+"-"+t,k=Array.isArray(u)?u.map((function(e){return Object.assign(e,{depth:d+1})})):u,y=(new n).setHooks(r.model).addHook(m).asSingleHook(),H=Object.assign({type:h,key:v,depth:d,component:f,definition:{attrs:Object.assign({},p,{modelHook:y})},children:c(k,{hooks:r,h:s,state:i})});return(new n).setHooks(r.schemaNode).setDefault((function(){return H})).apply(H,{state:i})}return null}function c(e,t){void 0===t&&(t={});var o=t.hooks,r=t.h,s=t.state;return Array.isArray(e)?e.map((function(e,t){var i=u(e,t,{hooks:o,h:r,state:s});return(new n).setHooks(o.schemaComponent).setDefault((function(){return r(i.component,i.definition,i.children)})).apply(i)})):e}var f={functional:!0,name:"FormulateSchema",props:{schema:e.defaults.components.FormulateForm.props.schema,hooks:s},data:function(){return{schemaHooks:null,schemaOptionsHooks:null}},mounted:function(){this.schemaHooks=(new n).setHooks(this.hooks.schema),this.schemaOptionsHooks=(new n).setHooks(this.hooks.schemaOptions).setDefault((function(e){return e}))},render:function(e,t){var o=t.props,r=(new n).setHooks(o.hooks.schema),s=(new n).setHooks(o.hooks.schemaOptions).setDefault((function(e){return e}));return function(){return r.apply(e("div",{},c(o.schema,s.apply({hooks:o.hooks,h:e,state:{}},{emit:emit,props:o}))),{emit:emit,props:o})}}},d={extends:e.defaults.components.FormulateForm,components:{FormulateSchema:f},props:{hooks:s},computed:{cleanedHooks:function(){var t=this,o=s.default();return Object.keys(o).forEach((function(e){o[e]=(new n).parse(t.hooks[e]).getHooks()})),e.merge(this.$formulate.options.hooks||{},o)}},watch:{formulateValue:{handler:function(e){var o=this;this.isVmodeled&&e&&"object"==typeof e&&Array.from(new Set(Object.keys(e).concat(Object.keys(this.proxy)))).forEach((function(r){t(e[r],o.proxy[r])||(o.setFieldValue(r,e[r]),o.registry.has(r)&&!t(e[r],o.registry.get(r).proxy)&&(o.registry.get(r).context.model=e[r]))}))},deep:!0}}},m=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("form",{class:e.classes,on:{submit:function(t){return t.preventDefault(),e.formSubmitted(t)}}},[e.schema?o("FormulateSchema",{attrs:{schema:e.schema,hooks:e.cleanedHooks},on:{events:function(t){return e.$emit("events",t)}}}):e._e(),e._v(" "),e.hasFormErrorObservers?e._e():o("FormulateErrors",{attrs:{context:e.formContext}}),e._v(" "),e._t("default")],2)};m._withStripped=!0;var p=i({render:m,staticRenderFns:[]},void 0,d,void 0,!1,void 0,!1,void 0,void 0,void 0),h=function(){this.store=new Map};h.prototype.on=function(e,t){var o=this.store.get(e);o&&o.push(t)||this.store.set(e,[t])},h.prototype.off=function(e,t){var o=this.store.get(e),r=o.indexOf(t);o&&r>-1&&o.splice(r,1)},h.prototype.emit=function(e,t){this.store.get(e).slice().map((function(e){return e(t)}))};var l={hooks:{schemaOptions:[{handler:function(e,t){void 0===t&&(t={});var o=t.emit;return e.state=e.state||{},e.state.eventBus=new h,e.state.eventBus.on("events",(function(e){return o("events",e)})),e}}],schemaNode:[{handler:function(e,t){void 0===t&&(t={});var o=t.state,r=e.definition.attrs,n=r.events;void 0===n&&(n=[]);var s=r.on;void 0===s&&(s={});var i=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===t.indexOf(r)&&(o[r]=e[r]);return o}(r,["events","on"]);return e.definition.attrs=i,e.definition.on=Object.assign({},s,n.reduce((function(t,r){return t[r]=function(t){s[r]&&s[r](t),o.eventBus.emit("events",{eventName:r,name:e.name,type:e.type,key:e.key,payload:t})},t}),{})),e}}]}},v={hooks:{model:[{handler:function(e,t){var r=t.context,n="vfe-mask"in r.attributes||"vfeMask"in r.attributes;if("text"===r.classification&&n){var s=r.attributes["vfe-mask"]||r.attributes.vfeMask,i="object"==typeof s&&s.mask?s:{mask:s};return o.createMask(i).resolve(e)}return e}}]}},k={hooks:{model:[{handler:function(e,t){var o=t.context,r="string"==typeof o.attributes.vfeNumber||o.attributes.vfeNumber||"string"==typeof o.attributes["vfe-number"]||o.attributes["vfe-number"];return"number"===o.type&&"string"==typeof e&&r?+e:e}}]}},y={FormulateForm:p,FormulateSchema:f,FormulateInput:a},H={formEvents:l,textMask:v,enforceNumber:k};export default function(e){void 0===e&&(e={});var t=r.merge({features:{formEvents:!0,textMask:!1,enforceNumber:!1},override:{FormulateForm:!0,FormulateInput:!0,FormulateSchema:!0}},e);return function(e){t.override.FormulateForm&&e.extend({components:{FormulateForm:p}}),t.override.FormulateInput&&e.extend({components:{FormulateInput:a}}),t.override.FormulateSchema&&e.extend({components:{FormulateSchema:f}}),t.features.formEvents&&e.extend(l),t.features.textMask&&e.extend(v),t.features.enforceNumber&&e.extend(k)}}export{y as components,H as features};
