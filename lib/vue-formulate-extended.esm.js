import t from"@braid/vue-formulate";import{shallowEqualObjects as e}from"@braid/vue-formulate/src/libs/utils.js";import o from"imask";import r from"@braid/vue-formulate/src/Formulate";var n=function(t){return void 0===t&&(t=[]),this.defaultHook=function(t){return t},this.setHooks(t)};n.prototype.parse=function(t){void 0===t&&(t=[]);var e=Array.isArray(t)?t:[];for(var o of e)this.isProperHook(o)&&this.hooks.push(o);return this},n.prototype.addHook=function(t){return this.isProperHook(t)&&this.isNewHook(t)&&this.hooks.push(t),this},n.prototype.setHooks=function(t){return void 0===t&&(t=[]),this.hooks=t.filter(this.isProperHook),this},n.prototype.setDefault=function(t){return this.defaultHook=t,this},n.prototype.isProperHook=function(t){return t&&"object"==typeof t&&"function"==typeof t.handler},n.prototype.isNewHook=function(t){return this.hooks.findIndex((function(e){return e===t}))<0},n.prototype.getHooks=function(){return this.hooks},n.prototype.empty=function(){return 0===this.hooks.length},n.prototype.apply=function(t,e){return this.empty()?this.defaultHook(t,e):this.hooks.reduce((function(t,o){return o.handler(t,e)}),t)},n.prototype.asSingleHook=function(){var t=this;return{handler:function(e,o){return t.apply(e,o)}}};var s={type:Object,default:function(){return{model:[],schema:[],schemaOptions:[],schemaNode:[],schemaComponent:[]}}};function i(t,e,o,r,n,s,i,a,u,c){"boolean"!=typeof i&&(u=a,a=i,i=!1);var f,m="function"==typeof o?o.options:o;if(t&&t.render&&(m.render=t.render,m.staticRenderFns=t.staticRenderFns,m._compiled=!0,n&&(m.functional=!0)),r&&(m._scopeId=r),s?(f=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,u(t)),t&&t._registeredComponents&&t._registeredComponents.add(s)},m._ssrRegister=f):e&&(f=i?function(t){e.call(this,c(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,a(t))}),f)if(m.functional){var p=m.render;m.render=function(t,e){return f.call(e),p(t,e)}}else{var h=m.beforeCreate;m.beforeCreate=h?[].concat(h,f):[f]}return o}var a=i({},void 0,{extends:t.defaults.components.FormulateInput,props:{modelHook:{type:[Function,Object,Array],default:null}},watch:{"context.model":{handler:function(t,e){var o=new n;Array.isArray(this.modelHook)?this.modelHook.map((function(t){return o.addHook(t)})):"function"==typeof this.modelHook?o.addHook({handler:this.modelHook}):o.addHook(this.modelHook),(this.$formulate.options.hooks&&this.$formulate.options.hooks.model?this.$formulate.options.hooks.model:[]).map((function(t){return o.addHook(t)})),t!==e&&(this.context.model=o.apply(t,{oldModel:e,context:this.context}))}}}},void 0,void 0,void 0,!1,void 0,void 0,void 0);function u(t,e,o){void 0===o&&(o={});var r=o.hooks,s=o.h,i=o.state;if(t&&"object"==typeof t&&!Array.isArray(t)){var u=t.children;void 0===u&&(u=null);var f=t.component;void 0===f&&(f=a);var m=t.depth;void 0===m&&(m=1);var p=t.modelHook,h=function(t,e){var o={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&-1===e.indexOf(r)&&(o[r]=t[r]);return o}(t,["children","component","depth","modelHook"]),d=f===a?h.type||"text":"",l=h.name||d||"el",v=h.id||l+"-"+m+"-"+e,k=Array.isArray(u)?u.map((function(t){return Object.assign(t,{depth:m+1})})):u,y=(new n).setHooks(r.model).addHook(p).asSingleHook(),H=Object.assign({type:d,key:v,depth:m,component:f,definition:{attrs:Object.assign({},h,{modelHook:y})},children:c(k,{hooks:r,h:s,state:i})});return(new n).setHooks(r.schemaNode).setDefault((function(){return H})).apply(H,{state:i})}return null}function c(t,e){void 0===e&&(e={});var o=e.hooks,r=e.h,s=e.state;return Array.isArray(t)?t.map((function(t,e){var i=u(t,e,{hooks:o,h:r,state:s});return(new n).setHooks(o.schemaComponent).setDefault((function(){return r(i.component,i.definition,i.children)})).apply(i)})):t}var f={functional:!1,name:"FormulateSchema",props:{schema:t.defaults.components.FormulateForm.props.schema,hooks:s,formClass:{type:String,default:null}},data:function(){return{schemaHooks:null,schemaOptionsHooks:null}},methods:{emit:function(t,e){this.$emit(t,e)}},beforeMount:function(){this.schemaHooks=(new n).setHooks(this.hooks.schema),this.schemaOptionsHooks=(new n).setHooks(this.hooks.schemaOptions).setDefault((function(t){return t}))},render:function(t){return this.schemaHooks.apply(t("div",{class:this.$props.formClass},c(this.schema,this.schemaOptionsHooks.apply({hooks:this.hooks,h:t,state:{}},{emit:this.emit,props:this.$props}))),{emit:this.emit,props:this.$props})}},m={extends:t.defaults.components.FormulateForm,components:{FormulateSchema:f},props:{hooks:s,formClass:{type:String,default:null}},computed:{cleanedHooks:function(){var e=this,o=s.default();return Object.keys(o).forEach((function(t){o[t]=(new n).parse(e.hooks[t]).getHooks()})),t.merge(this.$formulate.options.hooks||{},o)}},watch:{formulateValue:{handler:function(t){var o=this;this.isVmodeled&&t&&"object"==typeof t&&Array.from(new Set(Object.keys(t).concat(Object.keys(this.proxy)))).forEach((function(r){e(t[r],o.proxy[r])||(o.setFieldValue(r,t[r]),o.registry.has(r)&&!e(t[r],o.registry.get(r).proxy)&&(o.registry.get(r).context.model=t[r]))}))},deep:!0}}},p=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("form",{class:t.classes,on:{submit:function(e){return e.preventDefault(),t.formSubmitted(e)}}},[t.schema?o("FormulateSchema",{attrs:{schema:t.schema,hooks:t.cleanedHooks},on:{events:function(e){return t.$emit("events",e)}}}):t._e(),t._v(" "),t.hasFormErrorObservers?t._e():o("FormulateErrors",{attrs:{context:t.formContext}}),t._v(" "),t._t("default")],2)};p._withStripped=!0;var h=i({render:p,staticRenderFns:[]},void 0,m,void 0,!1,void 0,!1,void 0,void 0,void 0),d=function(){this.store=new Map};d.prototype.on=function(t,e){var o=this.store.get(t);o&&o.push(e)||this.store.set(t,[e])},d.prototype.off=function(t,e){var o=this.store.get(t),r=o.indexOf(e);o&&r>-1&&o.splice(r,1)},d.prototype.emit=function(t,e){this.store.get(t).slice().map((function(t){return t(e)}))};var l={hooks:{schemaOptions:[{handler:function(t,e){void 0===e&&(e={});var o=e.emit;return t.state=t.state||{},t.state.eventBus=new d,t.state.eventBus.on("events",(function(t){return o("events",t)})),t}}],schemaNode:[{handler:function(t,e){void 0===e&&(e={});var o=e.state,r=t.definition.attrs,n=r.events;void 0===n&&(n=[]);var s=r.on;void 0===s&&(s={});var i=function(t,e){var o={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&-1===e.indexOf(r)&&(o[r]=t[r]);return o}(r,["events","on"]);return t.definition.attrs=i,t.definition.on=Object.assign({},s,n.reduce((function(e,r){return e[r]=function(e){s[r]&&s[r](e),o.eventBus.emit("events",{eventName:r,name:t.name,type:t.type,key:t.key,payload:e})},e}),{})),t}}]}},v={hooks:{model:[{handler:function(t,e){var r=e.context,n="vfe-mask"in r.attributes||"vfeMask"in r.attributes;if("text"===r.classification&&n){var s=r.attributes["vfe-mask"]||r.attributes.vfeMask,i="object"==typeof s&&s.mask?s:{mask:s};return o.createMask(i).resolve(t)}return t}}]}},k={hooks:{model:[{handler:function(t,e){var o=e.context,r="string"==typeof o.attributes.vfeNumber||o.attributes.vfeNumber||"string"==typeof o.attributes["vfe-number"]||o.attributes["vfe-number"];return"number"===o.type&&"string"==typeof t&&r?+t:t}}]}},y={FormulateForm:h,FormulateSchema:f,FormulateInput:a},H={formEvents:l,textMask:v,enforceNumber:k};export default function(t){void 0===t&&(t={});var e=r.merge({features:{formEvents:!0,textMask:!1,enforceNumber:!1},override:{FormulateForm:!0,FormulateInput:!0,FormulateSchema:!0}},t);return function(t){e.override.FormulateForm&&t.extend({components:{FormulateForm:h}}),e.override.FormulateInput&&t.extend({components:{FormulateInput:a}}),e.override.FormulateSchema&&t.extend({components:{FormulateSchema:f}}),e.features.formEvents&&t.extend(l),e.features.textMask&&t.extend(v),e.features.enforceNumber&&t.extend(k)}}export{y as components,H as features};
