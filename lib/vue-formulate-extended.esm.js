import t from"@braid/vue-formulate";import{shallowEqualObjects as e}from"@braid/vue-formulate/src/libs/utils.js";import o from"imask";import n from"@braid/vue-formulate/src/Formulate";var r=function(t){return void 0===t&&(t=[]),this.defaultHook=function(t){return t},this.setHooks(t)};r.prototype.parse=function(t){void 0===t&&(t=[]);var e=Array.isArray(t)?t:[];for(var o of e)this.isProperHook(o)&&this.hooks.push(o);return this},r.prototype.addHook=function(t){return this.isProperHook(t)&&this.isNewHook(t)&&this.hooks.push(t),this},r.prototype.setHooks=function(t){return void 0===t&&(t=[]),this.hooks=t.filter(this.isProperHook),this},r.prototype.setDefault=function(t){return this.defaultHook=t,this},r.prototype.isProperHook=function(t){return t&&"object"==typeof t&&"function"==typeof t.handler},r.prototype.isNewHook=function(t){return this.hooks.findIndex((function(e){return e===t}))<0},r.prototype.getHooks=function(){return this.hooks},r.prototype.empty=function(){return 0===this.hooks.length},r.prototype.apply=function(t,e){return this.empty()?this.defaultHook(t,e):this.hooks.reduce((function(t,o){return o.handler(t,e)}),t)},r.prototype.asSingleHook=function(){var t=this;return{handler:function(e,o){return t.apply(e,o)}}};var s={type:Object,default:function(){return{model:[],schema:[],schemaOptions:[],schemaNode:[],schemaComponent:[]}}};function a(t,e,o,n,r,s,a,i,c,u){"boolean"!=typeof a&&(c=i,i=a,a=!1);var l,p="function"==typeof o?o.options:o;if(t&&t.render&&(p.render=t.render,p.staticRenderFns=t.staticRenderFns,p._compiled=!0,r&&(p.functional=!0)),n&&(p._scopeId=n),s?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,c(t)),t&&t._registeredComponents&&t._registeredComponents.add(s)},p._ssrRegister=l):e&&(l=a?function(t){e.call(this,u(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,i(t))}),l)if(p.functional){var m=p.render;p.render=function(t,e){return l.call(e),m(t,e)}}else{var h=p.beforeCreate;p.beforeCreate=h?[].concat(h,l):[l]}return o}var i={extends:t.defaults.components.FormulateInput,props:{modelHook:{type:[Function,Object,Array],default:null}},watch:{"context.model":{handler:function(t,e){var o=new r;Array.isArray(this.modelHook)?this.modelHook.map((function(t){return o.addHook(t)})):"function"==typeof this.modelHook?o.addHook({handler:this.modelHook}):o.addHook(this.modelHook),(this.$formulate.options.hooks&&this.$formulate.options.hooks.model?this.$formulate.options.hooks.model:[]).map((function(t){return o.addHook(t)})),t!==e&&(this.context.model=o.apply(t,{oldModel:e,context:this.context}))}}}},c=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{class:t.context.classes.outer,attrs:{"data-classification":t.classification,"data-has-errors":t.hasErrors,"data-is-showing-errors":t.hasVisibleErrors,"data-has-value":t.hasValue,"data-type":t.type},on:{click:function(e){return t.$emit("outer-click")}}},[o("div",{class:t.context.classes.wrapper,on:{click:function(e){return t.$emit("wrapper-click")}}},["before"===t.context.labelPosition?t._t("label",[t.context.hasLabel?o(t.context.slotComponents.label,t._b({tag:"component",attrs:{context:t.context}},"component",t.context.slotProps.label,!1)):t._e()],null,t.context):t._e(),t._v(" "),"before"===t.context.helpPosition?t._t("help",[t.context.help?o(t.context.slotComponents.help,t._b({tag:"component",attrs:{context:t.context}},"component",t.context.slotProps.help,!1)):t._e()],null,t.context):t._e(),t._v(" "),t._t("element",[o(t.context.component,t._g(t._b({tag:"component",attrs:{context:t.context}},"component",t.context.slotProps.component,!1),t.listeners),[t._t("default",null,null,t.context)],2)],null,t.context),t._v(" "),"after"===t.context.labelPosition?t._t("label",[t.context.hasLabel?o(t.context.slotComponents.label,t._b({tag:"component",attrs:{context:t.context}},"component",t.context.slotProps.label,!1)):t._e()],null,t.context):t._e()],2),t._v(" "),"after"===t.context.helpPosition?t._t("help",[t.context.help?o(t.context.slotComponents.help,t._b({tag:"component",attrs:{context:t.context}},"component",t.context.slotProps.help,!1)):t._e()],null,t.context):t._e(),t._v(" "),t._t("errors",[t.context.disableErrors?t._e():o(t.context.slotComponents.errors,t._b({tag:"component",attrs:{type:"FormulateErrors"===t.context.slotComponents.errors&&"input",context:t.context}},"component",t.context.slotProps.errors,!1))],null,t.context)],2)};c._withStripped=!0;var u=a({render:c,staticRenderFns:[]},void 0,i,void 0,!1,void 0,!1,void 0,void 0,void 0);function l(t,e,o){void 0===o&&(o={});var n=o.hooks,s=o.h,a=o.state;if(t&&"object"==typeof t&&!Array.isArray(t)){var i=t.children;void 0===i&&(i=null);var c=t.component;void 0===c&&(c=u);var l=t.depth;void 0===l&&(l=1);var m=t.modelHook,h=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(o[n]=t[n]);return o}(t,["children","component","depth","modelHook"]),f=c===u?h.type||"text":"",d=h.name||f||"el",v=h.id||d+"-"+l+"-"+e,k=Array.isArray(i)?i.map((function(t){return Object.assign(t,{depth:l+1})})):i,x=(new r).setHooks(n.model).addHook(m).asSingleHook(),y=Object.assign({type:f,key:v,depth:l,component:c,definition:{attrs:Object.assign({},h,{modelHook:x})},children:p(k,{hooks:n,h:s,state:a})});return(new r).setHooks(n.schemaNode).setDefault((function(){return y})).apply(y,{state:a})}return null}function p(t,e){void 0===e&&(e={});var o=e.hooks,n=e.h,s=e.state;return Array.isArray(t)?t.map((function(t,e){var a=l(t,e,{hooks:o,h:n,state:s});return(new r).setHooks(o.schemaComponent).setDefault((function(){return n(a.component,a.definition,a.children)})).apply(a)})):t}var m={functional:!1,name:"FormulateSchema",props:{schema:t.defaults.components.FormulateForm.props.schema,hooks:s,formClass:{type:String,default:null}},data:function(){return{schemaHooks:null,schemaOptionsHooks:null}},methods:{emit:function(t,e){this.$emit(t,e)}},beforeMount:function(){this.schemaHooks=(new r).setHooks(this.hooks.schema),this.schemaOptionsHooks=(new r).setHooks(this.hooks.schemaOptions).setDefault((function(t){return t}))},render:function(t){return this.schemaHooks.apply(t("div",{class:this.$props.formClass},p(this.schema,this.schemaOptionsHooks.apply({hooks:this.hooks,h:t,state:{}},{emit:this.emit,props:this.$props}))),{emit:this.emit,props:this.$props})}},h={extends:t.defaults.components.FormulateForm,components:{FormulateSchema:m},props:{hooks:s,formClass:{type:String,default:null}},computed:{cleanedHooks:function(){var e=this,o=s.default();return Object.keys(o).forEach((function(t){o[t]=(new r).parse(e.hooks[t]).getHooks()})),t.merge(this.$formulate.options.hooks||{},o)}},watch:{formulateValue:{handler:function(t){var o=this;this.isVmodeled&&t&&"object"==typeof t&&Array.from(new Set(Object.keys(t).concat(Object.keys(this.proxy)))).forEach((function(n){e(t[n],o.proxy[n])||(o.setFieldValue(n,t[n]),o.registry.has(n)&&!e(t[n],o.registry.get(n).proxy)&&(o.registry.get(n).context.model=t[n]))}))},deep:!0}}},f=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("form",{class:t.classes,on:{submit:function(e){return e.preventDefault(),t.formSubmitted(e)}}},[t.schema?o("FormulateSchema",{attrs:{schema:t.schema,hooks:t.cleanedHooks,formClass:t.formClass},on:{events:function(e){return t.$emit("events",e)}}}):t._e(),t._v(" "),t.hasFormErrorObservers?t._e():o("FormulateErrors",{attrs:{context:t.formContext}}),t._v(" "),t._t("default")],2)};f._withStripped=!0;var d=a({render:f,staticRenderFns:[]},void 0,h,void 0,!1,void 0,!1,void 0,void 0,void 0),v=function(){this.store=new Map};v.prototype.on=function(t,e){var o=this.store.get(t);o&&o.push(e)||this.store.set(t,[e])},v.prototype.off=function(t,e){var o=this.store.get(t),n=o.indexOf(e);o&&n>-1&&o.splice(n,1)},v.prototype.emit=function(t,e){this.store.get(t).slice().map((function(t){return t(e)}))};var k={hooks:{schemaOptions:[{handler:function(t,e){void 0===e&&(e={});var o=e.emit;return t.state=t.state||{},t.state.eventBus=new v,t.state.eventBus.on("events",(function(t){return o("events",t)})),t}}],schemaNode:[{handler:function(t,e){void 0===e&&(e={});var o=e.state,n=t.definition.attrs,r=n.events;void 0===r&&(r=[]);var s=n.on;void 0===s&&(s={});var a=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(o[n]=t[n]);return o}(n,["events","on"]);return t.definition.attrs=a,t.definition.on=Object.assign({},s,r.reduce((function(e,n){return e[n]=function(e){s[n]&&s[n](e),o.eventBus.emit("events",{eventName:n,name:t.name,type:t.type,key:t.key,payload:e})},e}),{})),t}}]}},x={hooks:{model:[{handler:function(t,e){var n=e.context,r="vfe-mask"in n.attributes||"vfeMask"in n.attributes;if("text"===n.classification&&r){var s=n.attributes["vfe-mask"]||n.attributes.vfeMask,a="object"==typeof s&&s.mask?s:{mask:s};return o.createMask(a).resolve(t)}return t}}]}},y={hooks:{model:[{handler:function(t,e){var o=e.context,n="string"==typeof o.attributes.vfeNumber||o.attributes.vfeNumber||"string"==typeof o.attributes["vfe-number"]||o.attributes["vfe-number"];return"number"===o.type&&"string"==typeof t&&n?+t:t}}]}},b={FormulateForm:d,FormulateSchema:m,FormulateInput:u},_={formEvents:k,textMask:x,enforceNumber:y};export default function(t){void 0===t&&(t={});var e=n.merge({features:{formEvents:!0,textMask:!1,enforceNumber:!1},override:{FormulateForm:!0,FormulateInput:!0,FormulateSchema:!0}},t);return function(t){e.override.FormulateForm&&t.extend({components:{FormulateForm:d}}),e.override.FormulateInput&&t.extend({components:{FormulateInput:u}}),e.override.FormulateSchema&&t.extend({components:{FormulateSchema:m}}),e.features.formEvents&&t.extend(k),e.features.textMask&&t.extend(x),e.features.enforceNumber&&t.extend(y)}}export{b as components,_ as features};
