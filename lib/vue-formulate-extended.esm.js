import{defineComponent as e,createElement as t}from"@vue/composition-api";import o from"@braid/vue-formulate";import{shallowEqualObjects as r}from"@braid/vue-formulate/src/libs/utils.js";import n from"imask";import s from"@braid/vue-formulate/src/Formulate";var i=function(e){return void 0===e&&(e=[]),this.defaultHook=function(e){return e},this.setHooks(e)};i.prototype.parse=function(e){void 0===e&&(e=[]);var t=Array.isArray(e)?e:[];for(var o of t)this.isProperHook(o)&&this.hooks.push(o);return this},i.prototype.addHook=function(e){return this.isProperHook(e)&&this.isNewHook(e)&&this.hooks.push(e),this},i.prototype.setHooks=function(e){return void 0===e&&(e=[]),this.hooks=e.filter(this.isProperHook),this},i.prototype.setDefault=function(e){return this.defaultHook=e,this},i.prototype.isProperHook=function(e){return e&&"object"==typeof e&&"function"==typeof e.handler},i.prototype.isNewHook=function(e){return this.hooks.findIndex((function(t){return t===e}))<0},i.prototype.getHooks=function(){return this.hooks},i.prototype.empty=function(){return 0===this.hooks.length},i.prototype.apply=function(e,t){return this.empty()?this.defaultHook(e,t):this.hooks.reduce((function(e,o){return o.handler(e,t)}),e)},i.prototype.asSingleHook=function(){var e=this;return{handler:function(t,o){return e.apply(t,o)}}};var a={type:Object,default:function(){return{model:[],schema:[],schemaOptions:[],schemaNode:[],schemaComponent:[]}}};function u(e,t,o,r,n,s,i,a,u,c){"boolean"!=typeof i&&(u=a,a=i,i=!1);var p,d="function"==typeof o?o.options:o;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,n&&(d.functional=!0)),r&&(d._scopeId=r),s?(p=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,u(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)},d._ssrRegister=p):t&&(p=i?function(e){t.call(this,c(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,a(e))}),p)if(d.functional){var f=d.render;d.render=function(e,t){return p.call(t),f(e,t)}}else{var m=d.beforeCreate;d.beforeCreate=m?[].concat(m,p):[p]}return o}var c=u({},void 0,{extends:o.defaults.components.FormulateInput,props:{modelHook:{type:[Function,Object,Array],default:null}},watch:{"context.model":{handler:function(e,t){var o=new i;Array.isArray(this.modelHook)?this.modelHook.map((function(e){return o.addHook(e)})):"function"==typeof this.modelHook?o.addHook({handler:this.modelHook}):o.addHook(this.modelHook),(this.$formulate.options.hooks&&this.$formulate.options.hooks.model?this.$formulate.options.hooks.model:[]).map((function(e){return o.addHook(e)})),e!==t&&(this.context.model=o.apply(e,{oldModel:t,context:this.context}))}}}},void 0,void 0,void 0,!1,void 0,void 0,void 0);function p(e,t,o){void 0===o&&(o={});var r=o.hooks,n=o.h,s=o.state;if(e&&"object"==typeof e&&!Array.isArray(e)){var a=e.children;void 0===a&&(a=null);var u=e.component;void 0===u&&(u=c);var p=e.depth;void 0===p&&(p=1);var f=e.modelHook,m=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===t.indexOf(r)&&(o[r]=e[r]);return o}(e,["children","component","depth","modelHook"]),h=u===c?m.type||"text":"",l=m.name||h||"el",v=m.id||l+"-"+p+"-"+t,k=Array.isArray(a)?a.map((function(e){return Object.assign(e,{depth:p+1})})):a,y=(new i).setHooks(r.model).addHook(f).asSingleHook(),b=Object.assign({type:h,key:v,depth:p,component:u,definition:{attrs:Object.assign({},m,{modelHook:y})},children:d(k,{hooks:r,h:n,state:s})});return(new i).setHooks(r.schemaNode).setDefault((function(){return b})).apply(b,{state:s})}return null}function d(e,t){void 0===t&&(t={});var o=t.hooks,r=t.h,n=t.state;return Array.isArray(e)?e.map((function(e,t){var s=p(e,t,{hooks:o,h:r,state:n});return(new i).setHooks(o.schemaComponent).setDefault((function(){return r(s.component,s.definition,s.children)})).apply(s)})):e}var f=e({name:"FormulateSchema",props:{schema:o.defaults.components.FormulateForm.props.schema,hooks:a},setup:function(e,o){var r=o.emit,n=(new i).setHooks(e.hooks.schema),s=(new i).setHooks(e.hooks.schemaOptions).setDefault((function(e){return e}));return function(){return n.apply(t("div",{},d(e.schema,s.apply({hooks:e.hooks,h:t,state:{}},{emit:r,props:e}))),{emit:r,props:e})}}}),m={extends:o.defaults.components.FormulateForm,components:{FormulateSchema:f},props:{hooks:a},computed:{cleanedHooks:function(){var e=this,t=a.default();return Object.keys(t).forEach((function(o){t[o]=(new i).parse(e.hooks[o]).getHooks()})),o.merge(this.$formulate.options.hooks||{},t)}},watch:{formulateValue:{handler:function(e){var t=this;this.isVmodeled&&e&&"object"==typeof e&&Array.from(new Set(Object.keys(e).concat(Object.keys(this.proxy)))).forEach((function(o){r(e[o],t.proxy[o])||(t.setFieldValue(o,e[o]),t.registry.has(o)&&!r(e[o],t.registry.get(o).proxy)&&(t.registry.get(o).context.model=e[o]))}))},deep:!0}}},h=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("form",{class:e.classes,on:{submit:function(t){return t.preventDefault(),e.formSubmitted(t)}}},[e.schema?o("FormulateSchema",{attrs:{schema:e.schema,hooks:e.cleanedHooks},on:{events:function(t){return e.$emit("events",t)}}}):e._e(),e._v(" "),e.hasFormErrorObservers?e._e():o("FormulateErrors",{attrs:{context:e.formContext}}),e._v(" "),e._t("default")],2)};h._withStripped=!0;var l=u({render:h,staticRenderFns:[]},void 0,m,void 0,!1,void 0,!1,void 0,void 0,void 0),v=function(){this.store=new Map};v.prototype.on=function(e,t){var o=this.store.get(e);o&&o.push(t)||this.store.set(e,[t])},v.prototype.off=function(e,t){var o=this.store.get(e),r=o.indexOf(t);o&&r>-1&&o.splice(r,1)},v.prototype.emit=function(e,t){this.store.get(e).slice().map((function(e){return e(t)}))};var k={hooks:{schemaOptions:[{handler:function(e,t){void 0===t&&(t={});var o=t.emit;return e.state=e.state||{},e.state.eventBus=new v,e.state.eventBus.on("events",(function(e){return o("events",e)})),e}}],schemaNode:[{handler:function(e,t){void 0===t&&(t={});var o=t.state,r=e.definition.attrs,n=r.events;void 0===n&&(n=[]);var s=r.on;void 0===s&&(s={});var i=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===t.indexOf(r)&&(o[r]=e[r]);return o}(r,["events","on"]);return e.definition.attrs=i,e.definition.on=Object.assign({},s,n.reduce((function(t,r){return t[r]=function(t){s[r]&&s[r](t),o.eventBus.emit("events",{eventName:r,name:e.name,type:e.type,key:e.key,payload:t})},t}),{})),e}}]}},y={hooks:{model:[{handler:function(e,t){var o=t.context,r="vfe-mask"in o.attributes||"vfeMask"in o.attributes;if("text"===o.classification&&r){var s=o.attributes["vfe-mask"]||o.attributes.vfeMask,i="object"==typeof s&&s.mask?s:{mask:s};return n.createMask(i).resolve(e)}return e}}]}},b={hooks:{model:[{handler:function(e,t){var o=t.context,r="string"==typeof o.attributes.vfeNumber||o.attributes.vfeNumber||"string"==typeof o.attributes["vfe-number"]||o.attributes["vfe-number"];return"number"===o.type&&"string"==typeof e&&r?+e:e}}]}},H={FormulateForm:l,FormulateSchema:f,FormulateInput:c},x={formEvents:k,textMask:y,enforceNumber:b};export default function(e){void 0===e&&(e={});var t=s.merge({features:{formEvents:!0,textMask:!1,enforceNumber:!1},override:{FormulateForm:!0,FormulateInput:!0,FormulateSchema:!0}},e);return function(e){t.override.FormulateForm&&e.extend({components:{FormulateForm:l}}),t.override.FormulateInput&&e.extend({components:{FormulateInput:c}}),t.override.FormulateSchema&&e.extend({components:{FormulateSchema:f}}),t.features.formEvents&&e.extend(k),t.features.textMask&&e.extend(y),t.features.enforceNumber&&e.extend(b)}}export{H as components,x as features};
